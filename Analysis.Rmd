---
title: "Analysis"
author: "Sglatt"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### current suicide group ###

```{r S Isolate variables}
RESST_sui_binary <- dplyr::select(RESST_sim_sui_di, # binary vars
                              R1, 
                              R2, 
                              R3,
                              R4, 
                              R5, 
                              R6,
                              R7, 
                              R8, 
                              R9,
                              R10, 
                              R11, 
                              R12,
                              R13, 
                              R14, 
                              R15,
                              R16, 
                              R17, 
                              R18,
                              R19, 
                              R20, 
                              R21,
                              )

# write.csv(RESST_sui_binary, 'FSA_dataset_274.csv') # csv with our final dataset

nodeNames = c( "R1_di","R2_di", "R3_di","R4_di", "R5_di", "R6_di","R7_di", "R8_di", "R9_di","R10_di", "R11_di","R12_di","R13_di","R14_di","R15_di","R16_di", "R17_di", "R18_di","R19_di", "R20_di", "R21_di")
```

```{r S Ising model}
RESST_sui_binary_res <- IsingFit(RESST_sui_binary, plot = FALSE) 

sim_sui_base_ising <- qgraph(RESST_sui_binary_res$weiadj,
                     theme = "colorblind",
                     nodeNames = nodeNames,
                     label.norm = "OOO",
                     legend = FALSE,
                     border.width = as.numeric(abs(RESST_sui_binary_res$thresholds)*3),
                     border.color = "purple") #  Node borders show the preference of the  node to be present/absent. > thickness shows lower likelihood to activate.

### get connectivity and threshold objects -  to use these in  (1) case simulations -- equilibrium perturbed -- and (2) phase stability analysis ###

connectivity_resst_sui_sim = RESST_sui_binary_res$weiadj 
thresholds_resst_sui_sim = RESST_sui_binary_res$thresholds 

## save connectivities and thresholds as dataframes and then excel files 
# connectivities

DF_ising_connectivities <- as.data.frame(connectivity_resst_sui_sim)

# write_xlsx(DF_ising_connectivities, 'DF_ising_connectivities.xlsx') # excel with ising model connectivities 
## this saved our connectivies as an excel

# save(DF_ising_connectivities, file="DF_ising_connectivities.Rdata") # Rdata file to directly import to R
## this saved our connectivies as Rdata

# thresholds

DF_ising_thresholds <- as.data.frame(thresholds_resst_sui_sim)

# write_xlsx(DF_ising_thresholds, 'DF_ising_thresholds.xlsx') # excel with ising model feature thresholds
## this saved our thresholds as an excel

# save(DF_ising_thresholds, file="DF_ising_thresholds.Rdata") # Rdata file to directly import to R
## this saved our thresholds as Rdata

# save image of ising model
pdf("sim_sui_base_ising", width=10, height=10)
plot(sim_sui_base_ising)

dev.off()

# view 
DF_ising_connectivities
DF_ising_thresholds
```

